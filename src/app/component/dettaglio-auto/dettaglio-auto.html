<div class="dettaglio-auto-container">
  <div class="container">
    <!-- Loading -->
    @if (loading()) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Caricamento...</span>
        </div>
      </div>
    }

    <!-- Errore -->
    @if (error()) {
      <div class="alert alert-danger" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>
        {{ error() }}
      </div>
    }

    @if (!loading() && !error() && car()) {
      <!-- Header -->
      <div class="page-header">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <h1 class="page-title">
              <i class="bi bi-car-front-fill me-2"></i>
              {{ car()!.marca }} {{ car()!.modello }}
            </h1>
            <p class="page-subtitle">Targa: <strong class="text-uppercase">{{ car()!.targa }}</strong></p>
          </div>
          <button class="btn btn-outline-secondary" (click)="goBack()">
            <i class="bi bi-arrow-left me-2"></i>
            Torna all'elenco
          </button>
        </div>
      </div>

      <!-- Alert messaggi -->
      @if (successMessage()) {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="bi bi-check-circle-fill me-2"></i>
          {{ successMessage() }}
          <button type="button" class="btn-close" (click)="successMessage.set(null)"></button>
        </div>
      }

      @if (errorMessage()) {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-circle-fill me-2"></i>
          {{ errorMessage() }}
          <button type="button" class="btn-close" (click)="errorMessage.set(null)"></button>
        </div>
      }

      <!-- Accordion Sections -->
      <div class="accordion-sections">
        
        <!-- SEZIONE ANAGRAFICA -->
        @if (car() && proprietario()) {
          <app-sezione-anagrafica 
            [car]="car()!" 
            [proprietario]="proprietario()!"
            (carUpdated)="onCarUpdated($event)">
          </app-sezione-anagrafica>
        }

        <!-- SEZIONE COPROPRIETARI -->
        @if (car()) {
          <app-sezione-coproprietari 
            [car]="car()!"
            (carUpdated)="onCarUpdated($event)">
          </app-sezione-coproprietari>
        }

        <!-- SEZIONE ASSICURAZIONI -->
        @if (car()) {
          <app-sezione-assicurazioni 
            [car]="car()!"
            (carUpdated)="onCarUpdated($event)">
          </app-sezione-assicurazioni>
        }

        <!-- SEZIONE TAGLIANDI -->
        @if (car()) {
          <app-sezione-tagliandi 
            [car]="car()!"
            (carUpdated)="onCarUpdated($event)">
          </app-sezione-tagliandi>
        }

        <!-- SEZIONE REVISIONI -->
        @if (car()) {
          <app-sezione-revisioni 
            [car]="car()!"
            (carUpdated)="onCarUpdated($event)">
          </app-sezione-revisioni>
        }

      </div>
    }
  </div>
</div>
